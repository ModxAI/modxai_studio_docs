# AI 对话

> v1.0.0
> 2025-12

本文介绍 ModxAI Studio 中**文本对话**与**多模态对话**功能的使用方法。帮助您完成日常对话推理、知识库问答、图文理解等任务。

## 目录

- [环境要求](#环境要求)
- [前置条件](#前置条件)
- [界面布局](#界面布局)
- [对话管理](#对话管理)
- [发送消息](#发送消息)
- [RAG 检索增强](#rag-检索增强)
- [推理参数设置](#推理参数设置)
- [消息操作](#消息操作)
- [数据收藏](#数据收藏)
- [注意事项](#注意事项)

---

## 环境要求

**本功能无需额外环境依赖**

文本对话和多模态对话功能使用 llama.cpp 作为推理引擎，无需在设置中提前在**设置**中安装环境。

您只需：
1. 在模型库中下载并加载聊天模型或多模态模型
2. 模型加载成功后即可开始对话

---

## 前置条件

在使用聊天功能前，您需要先在**模型库**页面加载模型：

- **文本对话**：加载"聊天模型"
- **图文对话**：加载"多模态模型"

未加载模型时，聊天页面会提示"前往模型库加载<聊天模型>"。

---

## 界面布局

聊天页面分为左右两栏：

### 左侧 - 会话列表

- **新建对话**按钮：位于顶部
- **会话列表**：按时间分组显示（今天/昨天/7天内/30天内/更早）
- **会话操作**：选项菜单可重命名或删除对话

### 右侧 - 聊天区域

- **消息列表**：显示当前对话的历史记录
- **输入框**：底部，包含以下功能：
  - **思考**开关：启用AI思考过程展示
  - **检索**开关：启用RAG知识库检索
  - 附件按钮（仅多模态模型时显示）
  - 提示词生成按钮（魔法棒图标）
  - 推理参数设置按钮（滑块图标）
  - 发送按钮

---

## 对话管理

### 新建对话

点击左侧顶部**"新建对话"**按钮。系统会：
1. 自动生成临时标题（如"新对话 10:30"）
2. 首次发送消息后，自动生成正式标题

### 切换对话

直接点击左侧会话列表中的任意对话。

### 重命名对话

1. 点击会话右侧的菜单
2. 选择**"重命名"**
3. 输入新标题并确认

### 删除对话

1. 点击会话右侧的菜单
2. 选择**"删除"**
3. 确认操作（此操作不可恢复）

---

## 发送消息

### 纯文本对话

1. 在输入框中输入问题
2. 点击发送按钮或按`Enter`键

### 图文对话（多模态）

**前提**：必须已加载多模态模型

1. 点击输入框左侧的**附件按钮**（链接图标）
2. 上传图片：
   - 点击"添加附件"按钮选择文件
   - 或直接拖拽图片到附件区
3. **支持格式**：JPG、PNG
4. 输入相关问题
5. 点击发送

**注意**：
- 图片会与文字一起发送给模型
- 不添加图片时，多模态模型会按文本模式工作

### 功能开关

在输入框上方有两个重要开关：

#### 思考开关
- **作用**：启用后，AI会展示思考过程
- **显示**：折叠面板"💭 AI 思考过程"
- **用途**：了解AI的推理逻辑

#### 检索开关
- **作用**：启用RAG知识库检索
- **前提**：必须先选择知识库（详见下一节）
- **效果**：AI会基于您的知识库内容回答问题

---

## RAG 检索增强

RAG可以让AI基于您自己的资料库回答问题。

### 准备工作

在使用前，需要在**数据模块**中创建RAG数据集（知识库）。

### 使用步骤

1. **打开推理参数设置**（点击输入框上方的滑块图标）
2. **展开"RAG模型配置"折叠面板**
3. **选择知识库**：从下拉框中选择已创建的数据集
4. **配置参数**（可选）：
   - **检索方法**：混合（推荐）/向量/向量+重排/文本
   - **TopK**：检索文档数量（默认5条）
   - **分数阈值**：相似度过滤（0-1，默认0.3）
   - **最大上下文长度**：单次检索的字符数上限
   - **RAG搜索提示词**：自定义检索行为指令
5. **关闭抽屉**
6. **开启输入框上方的"检索"开关**
7. 正常发送消息

### 删除知识库

在推理参数抽屉的知识库下拉框中，每个知识库右侧有删除按钮。

---

## 推理参数设置

点击输入框上方的**滑块图标**按钮，打开参数抽屉。

### 基础参数

#### 温度（Temperature）
- **范围**：0-1
- **默认值**：0.7
- **作用**：
  - 低温度（<0.5）：回答更稳定、保守
  - 高温度（>0.8）：回答更有创意、随机性强
- **调整方式**：滑块或直接输入数值
- **重置**：点击右侧重置按钮恢复默认值

#### 最大Token数
- **范围**：1-8192
- **默认值**：1024
- **作用**：限制单次回复的最大长度
- **注意**：过小可能导致回答被截断

#### 系统提示词
- **作用**：为AI设定角色或任务背景
- **保存模板**：常用提示词可保存为模板
- **删除模板**：选中模板后点击删除按钮

### RAG参数（折叠面板）

见上方 [RAG 检索增强](#rag-检索增强) 章节。

---

## 消息操作

### 用户消息（您发送的）

每条用户消息右侧有浮动按钮组：

- **编辑**：修改消息内容并保存
- **复制**：复制到剪贴板
- **删除**：删除该条消息
- **重新提交**：删除该消息及其后续所有对话，重新发送

**重新提交说明**：
- 会删除该消息之后的全部内容
- 适用于发现输入错误，需要重新提问的情况
- 操作不可撤销，请谨慎使用

### AI回复

每条AI回复右侧有浮动按钮组：

- **收藏**（点赞图标）：添加到收藏数据集
- **不喜欢**（点踩图标）：标记为不满意(从已添加的收藏中移除)
- **复制**：复制回复内容
- **删除**：删除该条回复

**思考过程查看**：
- 若开启了"思考"开关
- AI回复上方会显示折叠面板"💭 AI 思考过程"
- 点击展开可查看推理步骤

---

## 数据收藏

### 收藏方式

对满意的AI回复点击**收藏按钮**（点赞图标）。系统会：
1. 标记该条回复为"已收藏"
2. 自动添加到收藏数据集
3. 左下角浮动按钮显示收藏数量

### 管理收藏

点击左下角**收藏图标浮动按钮**，打开数据管理器：

- **查看列表**：所有收藏的问答对
- **编辑**：修改问题或回答内容
- **删除**：移除不需要的数据
- **导出**：导出为可训练数据集
  - 设置导出名称
  - 配置质量过滤条件
  - 选择导出位置
  - 一键导出为标准格式

**导出用途**：
- 用于模型微调训练
- 构建新的RAG知识库
- 备份重要对话记录

---

## 注意事项

### 模型要求

- **文本对话**：必须加载聊天模型
- **图文对话**：必须加载多模态模型
- 功能开关会根据当前模型自动启用或禁用

### RAG使用限制

- 必须先创建RAG数据集
- 开启检索开关后必须选择知识库
- 未选择知识库时会提示错误

### 图片格式限制

- **支持**：JPG、PNG
- **不支持**：GIF、BMP、WebP等其他格式
- 上传不支持的格式会被拒绝

### 空回复处理

极少数情况下，AI可能无法生成有效回复，此时会显示：
- "模型未返回有效回复"

建议：
- 重新表述问题
- 检查模型是否正常加载
- 查看推理参数是否合理

### 上下文管理

- 每个对话独立维护上下文
- 后端会自动管理上下文窗口长度
- 超长对话建议新建会话，避免上下文混乱

### 性能建议

- 高温度、长回复会增加推理时间
- 本地部署时注意资源消耗
- 适当控制并发对话数量

---

完成本章节学习后，您可以继续了解：
- **RAG数据生成**：如何创建和管理知识库
- **提示词生成**：使用AI辅助优化提示词
- **训练模块**：基于收藏数据微调模型
