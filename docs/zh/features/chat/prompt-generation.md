# 提示词优化

> v1.0.0
> 2025-12

本文介绍如何使用 ModxAI Studio 的**提示词优化**功能，帮助您快速生成高质量的提示词，提升与AI对话的效果。

## 目录

- [环境要求](#环境要求)
- [前置条件](#前置条件)
- [功能介绍](#功能介绍)
- [使用步骤](#使用步骤)
- [模板管理](#模板管理)
- [变量替换规则](#变量替换规则)
- [使用技巧](#使用技巧)

---

## 环境要求

**本功能无需额外环境依赖**

提示词生成功能使用 llama.cpp 作为推理引擎，无需在**设置**中提前安装环境。

---

## 前置条件

在使用提示词生成功能前，必须满足以下条件：

- **已加载文本模型**：在模型库中加载"聊天模型"
- 模型加载成功后，聊天页面输入框上方的魔法棒按钮才会启用

未加载模型时，点击魔法棒按钮会提示"请先输入用户内容并确保聊天模型已加载"。

---

## 功能介绍

**智能提示词生成的核心作用是优化您的提示词表达**，而不是让AI直接完成任务。

### 什么是提示词优化？

当您输入模糊、笼统的提示词时（如"帮我写个计算器"），AI很难理解您的真实需求。提示词优化功能会：

- **消除模糊表达**：将"好"、"快"、"简单"等模糊词转换为具体标准
- **补充关键信息**：自动推断并添加缺失的上下文和约束条件
- **结构化描述**：把混乱的想法整理成清晰、有逻辑的指令

### 三种优化模板

系统提供三种优化策略，分别适用于不同的输入场景：

#### 1. 通用提示词优化（chatprompt_general_optimizer）
- **适用场景**：输入比较清晰但表达不够精确
- **优化重点**：消除歧义、补充细节、提升可操作性
- **示例输入**："写一篇关于AI的文章"
- **优化后**："撰写一篇面向技术从业者的AI应用综述文章，字数1500-2000字，包含当前主流技术方向（大语言模型、计算机视觉、强化学习）的实际应用案例，要求数据准确、案例具体、语言专业但不失通俗性"

#### 2. 专业提示词优化（chatprompt_specialized_expert）
- **适用场景**：输入包含抽象概念，需要转换为具体规格
- **优化重点**：将模糊需求转换为可量化的精确描述
- **示例输入**："优化这段代码的性能"
- **优化后**："分析Python代码性能瓶颈，要求：1）使用cProfile进行性能分析；2）识别耗时超过100ms的函数；3）针对循环嵌套、重复计算、内存拷贝提出优化方案；4）提供优化前后的性能对比数据（执行时间、内存占用）；5）保持代码功能不变"

#### 3. 步骤化需求规划（chatprompt_steps_planner）
- **适用场景**：复杂任务，需要分解为多个步骤
- **优化重点**：将笼统目标转换为系统化的执行计划
- **示例输入**："用C++写一个计算器功能"
- **优化后**：生成包含角色定义、执行步骤、交付标准的完整结构化提示词（包括：需求分析、架构设计、代码实现、测试验证、文档编写等阶段性任务）

### 核心功能

- **智能变量替换**：自动将您的输入内容填充到模板占位符中
- **模板组合**：系统模板和用户模板配对使用，也可手动组合
- **一键应用**：优化后的提示词可直接填入聊天输入框
- **模板管理**：保存、删除自定义模板

---

## 使用步骤

### 1. 打开提示词生成对话框

在聊天页面底部输入框上方，点击**魔法棒图标**按钮。

### 2. 选择优化模板

对话框分为两个模板选择区域：

#### 系统提示词模板（定义优化专家角色）
- **作用**：设定提示词优化专家的能力和优化原则
- **位置**：左侧下拉框
- **可选项**：
  - **通用提示词优化**：消除歧义、补充上下文的基础优化专家
  - **专业提示词优化**：将抽象需求转换为精确规格的工程专家
  - **步骤化需求规划**：拆解复杂任务的战略规划专家

#### 用户提示词模板（定义优化指令）
- **作用**：明确对AI优化专家的要求和输出格式
- **位置**：右侧下拉框
- **变量支持**：模板中使用占位符 `{{userPrompt}}`，会被替换为您的原始输入

**模板配对机制**：
- **自动配对**：选择系统模板时，会自动选择匹配的用户模板
- **手动组合**：您也可以手动选择不同的系统和用户模板组合（虽然默认配对效果最好）

### 3. 编辑提示词内容

选择模板后，内容会自动填充到下方的文本框：

- **系统提示词**：可直接编辑，设定AI角色
- **用户提示词**：可直接编辑，定义任务要求
  - 支持占位符：`{userPrompt}` 或 `{{userPrompt}}`
  - 生成时会自动替换为下方"用户输入内容"

### 4. 输入需要优化的原始提示词

在**"用户输入内容"**文本框中输入您的原始提示词（通常是模糊、笼统的描述）。

**正确示例**：
```
写一个计算器
```
```
分析这段代码的问题
```
```
总结一下机器学习
```

**错误示例**（已经很明确的任务指令，无需优化）：
```
请将"人工智能正在改变世界"翻译成英文
```
```
计算 123 + 456 的结果
```

> **重要提示**：如果您的输入已经非常明确、具体，使用提示词优化反而会得到空洞或无意义的结果。此功能专为模糊、笼统的表达而设计。

### 5. 生成优化后的提示词

点击**"生成"**按钮，系统会：
1. 将您的原始提示词替换到用户提示词模板的 `{{userPrompt}}` 占位符中
2. 组合系统提示词（定义专家角色）和用户提示词（定义优化任务）
3. 调用**当前已加载的AI模型**分析您的输入，补充细节、消除歧义、结构化表达
4. 优化结果显示在**"生成结果"**文本框

**生成过程示例**：
- **原始输入**："写一个排序算法"
- **使用模板**：专业提示词优化
- **优化结果**："实现快速排序算法（Python），要求：1）使用递归方式实现；2）处理空数组和单元素数组的边界情况；3）支持自定义比较函数；4）时间复杂度O(nlogn)，空间复杂度O(logn)；5）添加详细的中文注释说明分区逻辑和递归终止条件；6）提供3个测试用例（整数数组、字符串数组、自定义对象数组）"

### 6. 应用到聊天

- **应用到聊天**按钮：将生成结果直接填充到聊天输入框
- **取消**按钮：关闭对话框，不保存任何内容

---

## 模板管理

### 保存模板

当您编辑了满意的提示词后，可以保存为模板方便下次使用：

1. 点击**"保存模板"**按钮
2. 输入模板信息：
   - **模板名称**（必填）：便于识别的名称
   - **模板描述**（可选）：说明模板的用途
3. 点击确认

**保存规则**：
- 会同时保存系统提示词和用户提示词为一对模板
- 系统提示词模板名称会自动添加后缀
- 用户提示词模板名称会自动添加后缀

### 删除模板

删除不需要的模板：

1. 选择要删除的模板（系统或用户）
2. 点击**删除按钮**（垃圾桶图标）
3. 确认删除操作

**注意**：
- 删除系统模板不会自动删除配对的用户模板
- 删除用户模板不会自动删除配对的系统模板
- 删除操作不可恢复

---

## 变量替换规则

用户提示词模板支持以下占位符，生成时会自动替换为"用户输入内容"：

### 支持的占位符格式, 且必须保留其中之一

**花括号格式**：
- `{userPrompt}`
- `{content}`
- `{user_content}`
- `{query}`
- `{originalPrompt}`
- `{input}`
- `{text}`

**Mustache格式**：
- `{{userPrompt}}`
- `{{content}}`
- `{{user_content}}`
- 等（与花括号格式对应）

### 变量替换示例

以下是用户提示词模板中如何使用占位符：

**用户提示词模板内容**（通用优化）：
```
Refine the following user prompt by removing ambiguity and enriching essential context.

Critical Instructions:
- Your objective is to optimize the prompt itself, not to execute or respond to its content.
- Output only the enhanced prompt—no explanations, preambles, or meta-commentary.
- Preserve the user's original intent while improving precision and completeness.

User prompt requiring optimization:
{{userPrompt}}

Enhanced prompt:
```

**用户输入的原始提示词**：
```
帮我分析一下这个数据集
```

**AI接收到的完整指令**（替换后）：
```
Refine the following user prompt by removing ambiguity and enriching essential context.

Critical Instructions:
- Your objective is to optimize the prompt itself, not to execute or respond to its content.
- Output only the enhanced prompt—no explanations, preambles, or meta-commentary.
- Preserve the user's original intent while improving precision and completeness.

User prompt requiring optimization:
帮我分析一下这个数据集

Enhanced prompt:
```

**AI返回的优化结果**（示例）：
```
对数据集进行探索性数据分析（EDA），要求：1）加载CSV格式数据集；2）输出数据集基本信息（行列数、字段类型、缺失值统计）；3）生成数值型字段的描述性统计（均值、中位数、标准差、最大最小值）；4）绘制关键字段的分布图（直方图、箱线图）；5）分析字段间的相关性并生成相关性热力图；6）识别异常值和数据质量问题；7）输出Markdown格式的分析报告
```

---

## 使用技巧

### 1. 根据输入特点选择模板

**判断标准**：

| 输入特征 | 推荐模板 | 原因 |
|---------|---------|-----|
| 表达模糊、词汇笼统（"帮我写个XX"） | 通用提示词优化 | 补充细节、消除歧义 |
| 包含抽象概念（"性能好"、"用户体验佳"） | 专业提示词优化 | 转换为可量化的具体指标 |
| 复杂任务、多个步骤（"开发一个完整的XX系统"） | 步骤化需求规划 | 拆解为系统化执行计划 |
| 已经很明确具体的指令 | **不需要优化** | 直接使用原始提示词 |

**示例对比**：

```
❌ 不适合：已经很明确的指令
输入："将'hello world'翻译成中文"
结果：优化后反而变得冗余或无实际内容

✅ 适合通用优化：表达笼统
输入："翻译这段话"
结果：补充语言对、质量要求、格式要求等细节

✅ 适合专业优化：概念抽象
输入："优化代码性能"
结果：明确性能指标、分析方法、优化维度

✅ 适合步骤规划：复杂任务
输入："用C++写一个计算器功能"
结果：拆解为需求分析、架构设计、代码实现、测试验证等步骤
```

### 2. 理解模板配对逻辑

- **默认配对**：系统模板和用户模板使用相同的优化策略（general、specialized、steps）
- **手动组合**：技术上可以混搭（如系统用general，用户用specialized），但通常默认配对效果最好
- **为什么要分开**：系统提示词定义"优化专家的能力"，用户提示词定义"具体的优化任务"，分离设计让模板更灵活

### 3. 编辑模板内容

选择模板后，您可以修改系统或用户提示词的内容：

- **系统提示词**：调整专家的能力描述、优化原则
- **用户提示词**：修改对AI的指令、输出格式要求
- **注意保留**：`{{userPrompt}}` 占位符必须保留，否则您的输入无法被填充

### 4. 迭代优化策略

如果生成结果不理想：

1. **检查输入**：确认原始提示词是否足够模糊（太明确的指令无需优化）
2. **切换模板**：尝试其他优化策略
3. **调整指令**：修改用户提示词模板中的要求（如"增加技术深度"、"简化表达"等）
4. **重新生成**：点击"生成"按钮再次优化

### 5. 保存自定义模板

适合保存为模板的场景：

- **特定领域优化**：如"前端代码优化"、"学术论文提示词优化"
- **固定输出格式**：如"生成Markdown格式的步骤化计划"
- **企业/团队规范**：统一团队的提示词优化标准

**命名建议**：
- 描述优化侧重点：如"强调安全性的代码优化"
- 标注适用场景：如"数据分析任务_步骤规划"
- 区分版本：如"通用优化_v2（简化版）"

---

## 常见问题

### 生成按钮无法点击？

**原因**：
- 聊天模型未加载
- "用户输入内容"为空

**解决**：
1. 前往模型库加载"聊天模型"（文本模型）
2. 在"用户输入内容"框中输入您的原始提示词

---

### 生成的结果是空的或没有意义？

**最常见原因**：您的输入已经太明确，没有优化空间。

**示例**：
```
❌ 错误使用：
输入："请将123+456的结果告诉我"
问题：指令已经非常明确，AI无法"优化"这个提示词

✅ 正确使用：
输入："写个计算器"
优化后："开发一个基于Python的命令行计算器程序，要求：1）支持四则运算和括号优先级；2）处理小数和负数；3）检测除零错误并提示；4）支持连续计算；5）提供清晰的用户输入提示和错误处理；6）添加代码注释"
```

**解决方法**：
- 使用更模糊、更笼统的输入
- 如果任务本身就很明确，直接在聊天框输入即可，不需要提示词优化

---

### 应该选择哪个模板？

**简单判断**：

1. **输入很简单笼统**（如"写个爬虫"）→ **通用优化**
2. **输入有抽象词汇**（如"高性能"、"用户友好"）→ **专业优化**
3. **输入是复杂任务**（如"开发一个博客系统"）→ **步骤规划**

**不确定时**：先用通用优化试试，不满意再换其他模板。

---

### 变量没有被替换？

**检查项**：
- 用户提示词模板中是否包含 `{{userPrompt}}` 或其他支持的占位符
- 占位符格式是否正确（花括号 `{}` 或双花括号 `{{}}`）
- 是否在"用户输入内容"框中输入了内容

**提示**：系统默认模板已经包含占位符，通常不会出现此问题。只有在自定义模板时需要注意。

---

### 为什么要分系统提示词和用户提示词？

- **系统提示词**：定义"提示词优化专家"的身份、能力、优化原则（类似角色设定）
- **用户提示词**：定义具体的优化任务和输出要求（类似任务指令）

**打个比方**：
- 系统提示词 = 招聘一个"精通提示词优化的专家"
- 用户提示词 = 给这个专家下达"优化我这个提示词"的任务

分离设计让模板更灵活，可以组合不同的专家能力和任务要求。

---

### 优化结果可以再次优化吗？

可以，但通常不推荐：

1. **第一次优化**：将模糊提示词优化为明确指令
2. **第二次优化**：因为已经很明确，通常得不到有价值的结果

**更好的做法**：
- 直接修改第一次的优化结果（手动调整细节）
- 或者调整原始输入，重新生成

---

完成本章节学习后，您可以继续了解：
- **AI对话**：如何使用生成的提示词进行对话
- **推理参数设置**：调整生成效果的高级参数
- **数据收藏**：保存优秀的对话记录
