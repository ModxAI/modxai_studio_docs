# TTS 语音合成

> v1.0.0
> 2025-12

本文介绍 ModxAI Studio 的 **TTS（文本转语音）** 功能，帮助您了解如何使用本地 TTS 模型将文本转换为自然语音。

## 目录

- [环境要求](#环境要求)
- [功能介绍](#功能介绍)
- [前置条件](#前置条件)
- [界面布局](#界面布局)
- [支持的语言](#支持的语言)
- [基本操作](#基本操作)
- [参数配置](#参数配置)
- [会话管理](#会话管理)
- [注意事项](#注意事项)

---

## 环境要求

**本功能需要在设置中安装 GPU 或 CPU 环境依赖。**

TTS 使用 Kokoro 系列模型进行语音合成。使用前请确保：

1. 在**设置**中成功安装 CPU 或 GPU 环境
2. 在**模型库**中成功加载 **TTS（语音合成）** 类型的模型

> **GPU 加速（推荐）**
>
> - **NVIDIA 显卡（推荐）**：
>   - TTS 推理支持 CUDA 加速，在 NVIDIA GPU 上运行速度更快
>   - 建议安装 GPU 环境以获得最佳性能
>
> - **AMD 显卡（限制）**：
>   - Windows 平台 AMD GPU 暂不支持 TTS 推理加速
>   - AMD 用户需使用 CPU 模式进行推理
>
> - **CPU 模式**：
>   - 支持纯 CPU 推理，但速度相对较慢
>   - 部分 AMD CPU 可能存在兼容性问题，若推理失败建议尝试 NVIDIA GPU 环境

---

## 功能介绍

TTS（Text-to-Speech）是一个专用的文本转语音功能模块，支持：

- **中英双语合成**：支持中文和英文文本的语音合成
- **多音色选择**：提供多种预设音色供选择
- **语速调节**：可调整语音播放速度
- **自动语言检测**：根据输入文本自动识别语言
- **会话式交互**：支持多轮生成，便于对比不同参数效果

---

## 前置条件

1. **必须先安装环境**
   - 前往**设置**页面
   - 安装 CPU 或 GPU 环境（推荐 GPU 环境）
   - 等待环境安装完成并刷新状态

2. **必须先加载 TTS 模型**
   - 前往**模型库**页面
   - 导入或下载 TTS 模型(暂时仅支持 Kokoro 系列模型)
   - 在 **TTS（语音合成）** 标签页加载模型
   - 模型加载成功后，TTS 页面功能将自动解锁

3. **了解环境能力**
   - 环境安装后，需等待 TTS 能力检测完成
   - 刷新环境状态查看 TTS 能力是否可用
   - 若能力不可用，可尝试重新安装或修复环境

---

## 界面布局

TTS 界面采用左右双栏布局：

### 左侧边栏（会话列表）
- **新建会话**按钮：位于顶部
- **会话列表**：按时间分组（今天/昨天/最近7天/最近30天/更早）
  - 显示会话标题（根据首次输入文本自动生成）

### 右侧面板（生成区域）
- **消息列表**：显示用户输入文本和生成的音频
- **进度条**：生成过程中显示在消息列表下方
- **输入框**：底部区域，用于输入待转换的文本
- **参数按钮**：输入框底部工具栏，点击打开参数抽屉
- **生成按钮**：工具栏右下角

> **模型未加载提示**：右侧面板会显示"前往模型库加载<语音合成模型>"按钮，点击可跳转至模型库。

---

## 支持的语言

当前版本 TTS 功能支持以下语言：

| 语言代码 | 语言 | 说明 |
|----------|------|------|
| `a` | 美式英语 | American English |
| `b` | 英式英语 | British English |
| `z` | 普通话 | Mandarin Chinese |

> **自动语言检测**：
> - 当语言参数设置为"自动"时，系统会根据文本内容自动检测语言
> - 检测到中文字符时自动使用中文模式
> - 检测到英文字符时自动使用英语模式

> ⚠️ **语言限制**：
> - 当前版本仅支持中英双语
> - 日语等其他语言需要额外的依赖库（如 pyopenjtalk），暂未内置

---

## 基本操作

### 新建会话

1. 点击左侧边栏顶部的**新建会话**按钮
2. 系统会创建新会话并自动切换到该会话
3. 会话标题在首次生成后自动根据输入文本生成

### 输入文本并生成

1. 在输入框中输入待转换的文本
2. 点击**生成**按钮（或按 `Ctrl+Enter`）
3. 系统立即显示用户消息并开始生成
4. 生成完成后，AI 消息会显示音频播放器

> **提示**：
> - 文本支持中英文混合输入
> - 较长的文本会自动按段落分割处理
> - 生成过程中会显示实时进度

### 播放与保存

1. 生成完成后，点击音频播放器即可播放
2. 可使用**另存为**按钮将音频保存到本地
3. 默认保存格式为 WAV

---

## 参数配置

点击输入框底部工具栏的**参数按钮**（滑块图标）打开参数抽屉。

### 基础参数

| 参数 | 默认值 | 范围 | 说明 |
|------|--------|------|------|
| **音色** | af_heart | 预设列表 | 选择语音音色 |
| **语速** | 1.0 | 0.5-2.0 | 语音播放速度，1.0 为正常速度 |
| **语言** | 自动 | auto/a/b/z | 语言代码，auto 为自动检测 |
| **采样率** | 24000 | 16000/22050/24000/44100 | 输出音频采样率 |

### 音色预设

系统内置多种音色预设：

| 音色名称 | 性别 | 说明 |
|----------|------|------|
| af_heart | 女 | 默认女声 |
| af_bella | 女 | 温柔女声 |
| af_nicole | 女 | 清晰女声 |
| af_sky | 女 | 明亮女声 |
| bf_emma | 女 | 自然女声 |
| bf_isabella | 女 | 柔和女声 |
| am_adam | 男 | 稳重男声 |
| am_michael | 男 | 磁性男声 |
| bm_george | 男 | 沉稳男声 |
| bm_lewis | 男 | 清朗男声 |

> **音色说明**：
> - `af_` / `bf_` 前缀为女声
> - `am_` / `bm_` 前缀为男声
> - 具体可用音色取决于加载的模型

### 语速调节

| 语速值 | 效果 |
|--------|------|
| 0.5 | 慢速播放 |
| 1.0 | 正常速度 |
| 1.5 | 快速播放 |
| 2.0 | 极快播放 |

---

## 会话管理

### 选择会话
- 点击左侧列表中的会话项即可切换

### 重命名会话
1. 右键点击会话项（或点击会话右侧 `···` 菜单）
2. 选择**重命名**
3. 输入新标题
4. 点击**确认**

### 删除会话
1. 右键点击会话项
2. 选择**删除**
3. 确认删除（将删除会话及所有消息和生成的音频记录）

---

## 注意事项

### 环境依赖

1. **TTS 依赖库**
   - TTS 功能依赖 misaki 库进行 G2P（字素到音素）转换
   - 该库使用 PyPI 官方源安装，中国内地网络可能下载较慢
   - 安装失败不影响主环境，可通过重新安装修复

2. **spaCy 模型**
   - TTS 功能还依赖 spaCy 的语言模型（en_core_web_sm、zh_core_web_sm）
   - 这些模型在环境安装后会**异步下载**
   - 下载完成时间取决于网络状况，可能延迟数十秒至数分钟
   - 主环境安装完成后，请**刷新环境状态**确认 TTS 能力是否可用

3. **能力状态检测**
   - 以环境刷新后的 TTS 能力状态为准
   - 若 TTS 能力显示不可用，表示依赖未完全安装
   - 可通过**重新安装**或**修复环境**再次下载相关依赖

### 硬件兼容性

1. **推荐配置**
   - NVIDIA GPU + CUDA 环境：推理速度最快
   - 8GB+ 显存效果更佳

2. **CPU 模式限制**
   - 纯 CPU 推理速度较慢，长文本生成可能需要较长时间
   - 部分 AMD CPU 可能存在兼容性问题
   - 若遇到推理失败，建议切换至 NVIDIA GPU 环境

### 生成限制

1. **并发限制**
   - 同时只能进行一个生成任务
   - 生成过程中无法发送新消息

2. **文本长度**
   - 支持长文本自动分段处理
   - 建议单次输入不超过 2000 字符以获得最佳体验

3. **配额消耗**
   - 每次成功生成消耗 1 个数据配额

### 数据管理

1. **历史记录**
   - 会话和消息持久化存储在本地数据库
   - 卸载应用不会删除本地数据库

2. **音频存储**
   - 生成的音频默认保存到系统临时目录
   - 重要音频请及时保存到指定位置

---

## 常见问题

**Q：为什么 TTS 功能不可用？**

A：检查以下几点：
1. 是否已在设置中安装环境
2. 环境安装后是否刷新了状态
3. TTS 能力是否显示为可用
4. 是否已加载 TTS 模型

**Q：为什么生成的语音听起来不自然？**

A：尝试以下调整：
1. 检查输入文本是否有语法错误
2. 尝试不同的音色预设
3. 调整语速参数
4. 确保语言设置与文本内容匹配

**Q：中国内地安装 TTS 依赖很慢怎么办？**

A：
1. misaki 库使用 PyPI 官方源安装，国内网络可能较慢
2. 安装过程中请保持网络稳定
3. 若超时失败，可通过重新安装环境重试
4. spaCy 模型为异步下载，请耐心等待并刷新状态

**Q：提示 TTS 能力不可用怎么办？**

A：
1. 刷新环境状态，等待能力检测完成
2. 若仍不可用，尝试重新安装环境
3. 检查网络连接是否正常
4. 查看安装日志了解具体失败原因

---

## 后续文档

- [模型库](../models/overview.md) - 了解如何导入和加载 TTS 模型
- [环境配置](../settings/environment.md) - 了解环境安装详情
